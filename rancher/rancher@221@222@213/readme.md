[toc]
<br>
<br><br>


#rancher
使用rancher进行镜像管理，rancher控制台在192.168.33.221:8080



####新建服务

根据需要选择运行几个容器
* 使用私服镜像 如:  `192.168.33.211:5000/appserver:dejionline` 注意带版本号
* 选择创建时总是拉取镜像
* 命令 `npm start`
* 自动启动 测试环境建议选从不（仅启动一次）
* 挂载卷 `/root/.pm2/logs:/root/.pm2/logs`以及时区文件
* 配置node_type `front_end` or `back_end`  or `service`
* 选择调度策略 `node＝true` or 在222上部署全部容器
* 健康检查 可选 

####升级服务
同上

####负载均衡
在应用栈界面下拉选择添加负载均衡服务

* 监听端口
源ip/端口 选择130 缺省目标端口选择130
源ip/端口 选择99 缺省目标端口选择99

* 目标
源端口 选择130 目标服务选择appservice 目标端口选择130
源端口 选择99 目标服务选择manageservice 目标端口选择99

* 调度
部署在`192.168.33.213`

####发布新代码
webhooks 或者手动调用forwarder上的脚本然后重启对应rancher服务即可

####基础架构
在主机界面选择显示系统容器
在Network Agent容器运行 `vi /etc/resolv.conf `
查看dns


<br>
<br><br>

#rancher agent@192.168.33.222

####修改dns
 登录rancher angent机器 运行`vi /etc/resolv.conf `

```
# Generated by NetworkManager


# No nameservers found; try putting DNS servers into your
# ifcfg files in /etc/sysconfig/network-scripts like so:
#
# DNS1=202.106.196.115
# DNS2=xxx.xxx.xxx.xxx
# DOMAIN=lab.foo.com bar.foo.com
nameserver 192.168.33.1
#nameserver 218.2.2.2
search localdomain
```

重启rancher agent